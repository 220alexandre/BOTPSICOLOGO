{% extends "base.html" %} {% block title %}Painel de Administração{% endblock %}
{% block content %}
<div class="container mt-5">
  <h1>Painel de Administração</h1>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Email</th>
        <th>Plano</th>
        <th>Tokens Usados</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.id }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.plan }}</td>
        <td>{{ user.token_usage }}</td>
        <td>
          {% if user.stripe_subscription_id %}
          <form
            action="{{ url_for('admin_cancel_subscription', user_id=user.id) }}"
            method="post"
            style="display: inline"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <button type="submit" class="btn btn-danger btn-sm">
              Cancelar Assinatura
            </button>
          </form>
          {% else %}
          <span>N/A</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<table class="table">
  <thead>
    <tr>
      <th>Company</th>
      <th>Plan</th>
      <th>Token Limit</th>
      <th>Monthly Cost</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for company in companies %}
    <tr>
      <td>{{ company.name }}</td>
      <td>{{ company.plan }}</td>
      <td>{{ company.token_limit }}</td>
      <td>{{ company.monthly_cost }}</td>
      <td>
        <a
          href="{{ url_for('manage_company', company_id=company.id) }}"
          class="btn btn-primary"
          >Manage</a
        >
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
